#!/bin/bash

# This script checks to see if a webserver is up and responding with "200 OK".
# Part of the watchdog package, https://github.com/elgholm/watchdog

# History
# 2015-09-25 - Removed "HTTP/1.1" in check, and added so that a fail issues another request before alerting. /Charlie Elgholm
# 2015-09-22 - First version written by Charlie Elgholm

# Panics:       None
# Criticals:    If URL is not responding
# Warnings:     None

# URL to check
URL=https://www.swedbank-aktiellt.se/pls/casper/pub_uptime

RLINE=`curl -s --head $URL | head -n 1`
IS_UP=`echo $RLINE | grep -c "200 OK"`
if test $IS_UP -ne 1 ; then
        sleep 3
        RLINE=`curl -s --head $URL | head -n 1`
        IS_UP=`echo $RLINE | grep -c "200 OK"`
        if test $IS_UP -ne 1 ; then
                echo "CRITICAL: Webserver is not responding correctly! ($RLINE)"
        fi
fi
